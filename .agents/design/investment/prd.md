# Product Requirements Document (PRD): Investment Module

## 1. 简介 (Introduction)

### 1.1 目的
为 Cogni-Kit 添加个人投资管理模块，允许用户跟踪和分析多种类型的金融资产（股票、ETF、基金）。MVP 阶段侧重于“自选列表 (Watchlist)”和“深度行情详情 (Market Data Details)”的展示。

### 1.2 范围 (Scope)
*   **支持标的**: A股 (CN), 港股 (HK), 美股 (US), 场内基金 (ETF), 场外基金 (Funds).
*   **核心功能**:
    *   标的搜索与添加.
    *   自选列表管理 (分组).
    *   标的详情展示 (包含 K线与精简版 F10).
*   **数据源**: AkShare (开源财经数据接口).

---

## 2. 用户故事 (User Stories)

| ID         | 角色 | 故事描述                           | 验收标准                                                                                                                                           |
| :--------- | :--- | :--------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------- |
| **US-001** | 用户 | 我想通过名称或代码搜索股票/基金    | 1. 支持输入名称或代码模糊搜索。<br>2. 搜索结果显示标的类型（如股票/ETF）和所属市场。                                                               |
| **US-002** | 用户 | 我想将感兴趣的标的加入自选列表     | 1. 搜索结果页可直接添加。<br>2. 详情页可添加/移除自选。<br>3. 支持添加到特定分组。                                                                 |
| **US-003** | 用户 | 我想查看自选列表的实时行情         | 1. 列表显示：名称, 代码, 最新价, 涨跌额, 涨跌幅。<br>2. 列表支持按分组筛选/折叠。<br>3. 基金类显示净值而非实时价格。                               |
| **US-004** | 用户 | 我想对自选标的进行分组管理         | 1. 创建/重命名/删除分组。<br>2. 将标的在不同分组间移动。                                                                                           |
| **US-005** | 用户 | 我想查看股票/ETF的详细走势和基本面 | 1. 显示 K线图 (日/周/月) 和 均线 (MA5/10/20/60/250)。<br>2. 显示关键指标：市值, PE, PB, 换手率。<br>3. 显示精简 F10：行业, 主营业务, 重仓股(ETF)。 |

---

## 3. 功能需求 (Functional Requirements)

### 3.1 标的搜索与管理 (Symbol Management)
*   **数据源**: 依赖后端定时同步的基础数据表 (AssetMetadata)。
*   **搜索逻辑**: 本地数据库搜索 (高性能)，支持拼音首字母 (可选), 代码, 名称。
*   **添加/移除**: 修改用户的自选关联表。

### 3.2 自选列表 (Watchlist)
*   **展示字段**:
    *   **通用**: 名称 (Name), 代码 (Symbol).
    *   **股票/ETF**: 最新价 (Current), 涨跌额 (Chg), 涨跌幅 (Chg%).
    *   **场外基金**: 最新净值 (NAV), 日增长率 (Daily Return), 净值日期 (Date).
*   **刷新机制**:
    *   **自动刷新**: 交易时间每 5-10 秒轮询 (Polling) 或 SSE 推送 (MVP 可先做轮询)。
    *   **手动刷新**: 下拉刷新。

### 3.3 标的详情页 (Detail View)

#### 3.3.1 头部区域 (Header)
*   **基础信息**: 标的名称, 代码, 交易所/市场标记 (CN/HK/US).
*   **行情概览**: 大型字体显示最新价/净值, 配合红绿颜色表示涨跌。
*   **状态标签**: `交易中` (Trading), `休市` (Closed), `停牌` (Suspended).

#### 3.3.2 图表区域 (Charts)
*   **K线图 (Candlestick)**:
    *   **周期**: 日K, 周K, 月K.
    *   **均线 (MA)**: 覆盖在 K 线上的 5 条线 (MA5, MA10, MA20, MA60, MA250).
    *   **交互**: 支持缩放、游标查看具体日期数据.
*   **成交量 (Volume)**:
    *   与 K 线图时间轴对齐的柱状图.

#### 3.3.3 核心数据面板 (Key Statistics)
*   **股票 (Stock)**:
    *   `今开`, `昨收`, `最高`, `最低`.
    *   `成交量`, `成交额`, `换手率`.
    *   `总市值`, `市盈率(TTM)`, `市净率`.
*   **ETF**:
    *   同股票数据.
    *   `基金规模` (AUM), `溢折率`.
*   **场外基金 (Fund)**:
    *   `基金规模`, `成立日期`, `风险等级`.
    *   `基金经理`.

#### 3.3.4 精简版 F10 (Simplified F10)
*   **股票**:
    *   `所属行业`: 例如 "半导体".
    *   `主营业务`: 简短文本描述 (2-3行).
*   **ETF / 基金**:
    *   `十大重仓股` (Top 10 Holdings): 列表展示 (名称, 代码, 持仓比例).

---

## 4. 数据策略 (Data Strategy)

采用 **混合持久化 (Hybrid Persistence)** 策略：

### 4.1 资产类型定义
*   **STOCK**: 股票 (A股/港股/美股)
*   **ETF**: 场内交易型基金 (可在交易所实时买卖，有实时价格)
*   **FUND**: 场外基金 (通过基金公司申赎，仅有每日净值)

### 4.2 需入库数据 (Persisted Data)
*   **目的**: 支持搜索、关联关系、无需频繁更新的信息。
*   **内容**:
    *   `Asset`: 代码, 名称, 拼音首字母, 类型, 市场, 行业, 主营业务, 基金经理, 上次同步时间。
    *   `AssetHolding`: 基金/ETF 的最新十大重仓股 (定期更新)。
    *   `WatchlistGroup` + `WatchlistItem`: 用户自选分组和标的关联。
*   **更新频率**: 每日 02:00 AM 通过定时任务 (Cron) 从 AkShare 同步。

### 4.3 缓存策略 (Caching Strategy)

| 数据类型 | Redis Key 格式 | TTL | 说明 |
|:---------|:---------------|:----|:-----|
| **实时行情** | `inv:quote:{market}:{symbol}` | 5-10s (交易中) / 60s (休市) | 高频访问，短缓存 |
| **K 线原始数据** | `inv:kline:{market}:{symbol}:{period}` | 5-10 min | 日内不变，较长缓存 |
| **技术指标** | `inv:indicator:{market}:{symbol}:{period}:{expr}` | 1-2 min | 实时计算 + 短缓存 |
| **基金净值** | `inv:nav:{symbol}` | 1 hour | 每日更新一次，长缓存 |

### 4.4 技术指标规划

**MVP 阶段 (必须支持)**:
*   `ma(n)`: 移动平均线 (参数化，如 ma(5), ma(60), ma(250))
*   `ema(n)`: 指数移动平均
*   `vol`: 成交量
*   `macd(fast,slow,signal)`: MACD 指标

**第二期扩展**:
*   `rsi(n)`: 相对强弱指标
*   `boll(n,std)`: 布林带
*   `kdj(n,m1,m2)`: KDJ 随机指标

---

## 5. UI/UX 规范

*   **涨跌色**:
    *   A股: 红涨绿跌.
    *   港/美股: 绿涨红跌 (根据用户设置或市场惯例，MVP 可统一配置).
*   **布局**:
    *   采用 Shadcn UI 的卡片式布局。
    *   移动端适配优先，列表行高适中便于点击。
*   **交互**:
    *   点击列表行 -> 跳转详情页.
    *   详情页图表支持手势/鼠标滚轮缩放.
