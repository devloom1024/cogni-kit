# CogniKit è®¤è¯ç³»ç»Ÿå®æ–½è®¡åˆ’

**åˆ›å»ºæ—¶é—´**: 2026-01-17 15:54  
**è´Ÿè´£æ¨¡å—**: ç”¨æˆ·è®¤è¯ç³»ç»Ÿ (å®Œæ•´å®ç°)  
**é¢„è®¡å·¥æ—¶**: 6 å¤©

---

## ğŸ“‹ é¡¹ç›®èƒŒæ™¯

åŸºäº `.agents/design/auth` ç›®å½•ä¸‹çš„è®¾è®¡æ–‡æ¡£å’Œ `apps/server/prisma/schema.prisma` æ•°æ®åº“è®¾è®¡ï¼Œå®ç°å®Œæ•´çš„è®¤è¯ç³»ç»Ÿã€‚

**æ ¸å¿ƒç›®æ ‡**:
1. âœ… æ¸…ç†æ‰€æœ‰ä¸ç¬¦åˆè®¾è®¡æ–‡æ¡£çš„æ—§ä»£ç 
2. âœ… é‡æ–°å®ç° `packages/shared` æ¨¡å— (å‰åç«¯å…±äº«å±‚)
3. âœ… å®ç°åç«¯è®¤è¯ç³»ç»Ÿ (åŸºäº Hono + Prisma + JWT)
4. âœ… æ”¯æŒé‚®ç®±æ³¨å†Œ/ç™»å½•ã€å¯†ç ç™»å½•ã€OAuthã€Token åˆ·æ–°ç­‰å®Œæ•´æµç¨‹

---

## ğŸ¯ é˜¶æ®µåˆ’åˆ†

### **é˜¶æ®µ 0: ä»£ç æ¸…ç†ä¸å®¡è®¡** (30 åˆ†é’Ÿ)
- [ ] 0.1 å®¡è®¡ç°æœ‰ä»£ç ï¼Œæ ‡è®°éœ€è¦åˆ é™¤çš„æ—§å®ç°
- [ ] 0.2 å¤‡ä»½å½“å‰çŠ¶æ€ (git commit)
- [ ] 0.3 åˆ é™¤ä¸ç¬¦åˆè®¾è®¡çš„æ—§ä»£ç 

### **é˜¶æ®µ 1: å…±äº«æ¨¡å—é‡æ„** (2 å°æ—¶)
- [ ] 1.1 å®ç° `packages/shared/src/types/models.ts` (æšä¸¾ + æ•°æ®æ¨¡å‹)
- [ ] 1.2 å®ç° `packages/shared/src/types/api.ts` (API è¯·æ±‚/å“åº”ç±»å‹)
- [ ] 1.3 å®ç° `packages/shared/src/types/error.ts` (é”™è¯¯ç±»å‹ + é”™è¯¯ç )
- [ ] 1.4 å®ç° `packages/shared/src/schemas/auth.ts` (å®Œæ•´ Zod Schema)
- [ ] 1.5 å®ç° `packages/shared/src/schemas/user.ts` (ç”¨æˆ· Schema)
- [ ] 1.6 å®ç° `packages/shared/src/constants/index.ts` (å¸¸é‡å®šä¹‰)
- [ ] 1.7 å®ç° `packages/shared/src/utils/index.ts` (çº¯å·¥å…·å‡½æ•°)
- [ ] 1.8 æ›´æ–° `packages/shared/src/index.ts` (æ€»å¯¼å‡º)
- [ ] 1.9 ç±»å‹æ£€æŸ¥éªŒè¯

### **é˜¶æ®µ 2: åç«¯åŸºç¡€è®¾æ–½** (3 å°æ—¶)
- [ ] 2.1 é…ç½®ç¯å¢ƒå˜é‡éªŒè¯ (`config/env.ts`)
- [ ] 2.2 åˆå§‹åŒ– Prisma Client (`shared/db.ts`)
- [ ] 2.3 åˆå§‹åŒ– Redis Client (`shared/redis.ts`)
- [ ] 2.4 é…ç½® Pino æ—¥å¿—ç³»ç»Ÿ (`shared/logger.ts`)
- [ ] 2.5 é…ç½® i18next å›½é™…åŒ– (`shared/i18n/`)
- [ ] 2.6 å®ç°é‚®ä»¶æœåŠ¡å°è£… (`shared/email.ts`)
- [ ] 2.7 å®ç° JWT å·¥å…·å‡½æ•° (`shared/lib/jwt.ts`)
- [ ] 2.8 å®ç°å¯†ç åŠ å¯†å·¥å…· (`shared/lib/password.ts`)
- [ ] 2.9 å®ç°éšæœºç ç”Ÿæˆå·¥å…· (`shared/lib/random.ts`)
- [ ] 2.10 å®ç°ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ (`middleware/error-handler.ts`)
- [ ] 2.11 å®ç°è®¤è¯ä¸­é—´ä»¶ (`middleware/auth.ts`)
- [ ] 2.12 å®ç°é™æµä¸­é—´ä»¶ (`middleware/rate-limit.ts`)

### **é˜¶æ®µ 3: æ ¸å¿ƒè®¤è¯åŠŸèƒ½** (1 å¤©)
- [ ] 3.1 å®ç° `POST /auth/send-code` (å‘é€éªŒè¯ç )
  - [ ] 3.1.1 Service: `sendVerificationCode()`
  - [ ] 3.1.2 é˜²åˆ·é€»è¾‘ (Redis é™æµ)
  - [ ] 3.1.3 Route Handler
  - [ ] 3.1.4 æµ‹è¯•éªŒè¯
  
- [ ] 3.2 å®ç° `POST /auth/register` (é‚®ç®±æ³¨å†Œ)
  - [ ] 3.2.1 Service: `register()`
  - [ ] 3.2.2 éªŒè¯ç æ ¡éªŒ
  - [ ] 3.2.3 ç”¨æˆ·åç”Ÿæˆ
  - [ ] 3.2.4 äº‹åŠ¡å¤„ç†
  - [ ] 3.2.5 Route Handler
  - [ ] 3.2.6 æµ‹è¯•éªŒè¯
  
- [ ] 3.3 å®ç° `POST /auth/login` (è´¦å·å¯†ç ç™»å½•)
  - [ ] 3.3.1 Service: `login()`
  - [ ] 3.3.2 ç”¨æˆ·æŸ¥æ‰¾ (email OR username)
  - [ ] 3.3.3 å¯†ç éªŒè¯
  - [ ] 3.3.4 çŠ¶æ€æ£€æŸ¥
  - [ ] 3.3.5 Route Handler
  - [ ] 3.3.6 æµ‹è¯•éªŒè¯
  
- [ ] 3.4 å®ç° `POST /auth/refresh-token` (åˆ·æ–° Token)
  - [ ] 3.4.1 Service: `refreshToken()`
  - [ ] 3.4.2 Token è½®æ¢æœºåˆ¶
  - [ ] 3.4.3 Route Handler
  - [ ] 3.4.4 æµ‹è¯•éªŒè¯
  
- [ ] 3.5 å®ç° `POST /auth/logout` (ç™»å‡º)
  - [ ] 3.5.1 Service: `logout()`
  - [ ] 3.5.2 Session æ’¤é”€
  - [ ] 3.5.3 Route Handler
  - [ ] 3.5.4 æµ‹è¯•éªŒè¯
  
- [ ] 3.6 å®ç° `POST /auth/forgot-password` (é‡ç½®å¯†ç )
  - [ ] 3.6.1 Service: `resetPassword()`
  - [ ] 3.6.2 éªŒè¯ç æ ¡éªŒ
  - [ ] 3.6.3 å¯†ç æ›´æ–°
  - [ ] 3.6.4 Route Handler
  - [ ] 3.6.5 æµ‹è¯•éªŒè¯

### **é˜¶æ®µ 4: OAuth é›†æˆ** (1 å¤©)
- [ ] 4.1 å®ç° GitHub OAuth
  - [ ] 4.1.1 `GET /auth/github/url` (è·å–æˆæƒé“¾æ¥)
  - [ ] 4.1.2 `POST /auth/github/callback` (å¤„ç†å›è°ƒ)
  - [ ] 4.1.3 è´¦å·ç»‘å®šé€»è¾‘
  - [ ] 4.1.4 æµ‹è¯•éªŒè¯
  
- [ ] 4.2 å®ç° Google OAuth
  - [ ] 4.2.1 `GET /auth/google/url`
  - [ ] 4.2.2 `POST /auth/google/callback`
  - [ ] 4.2.3 è´¦å·ç»‘å®šé€»è¾‘
  - [ ] 4.2.4 æµ‹è¯•éªŒè¯

### **é˜¶æ®µ 5: ç”¨æˆ·åŠŸèƒ½** (2 å°æ—¶)
- [ ] 5.1 å®ç° `GET /users/me` (è·å–å½“å‰ç”¨æˆ·)
  - [ ] 5.1.1 Service: `getCurrentUser()`
  - [ ] 5.1.2 Route Handler
  - [ ] 5.1.3 æµ‹è¯•éªŒè¯

### **é˜¶æ®µ 6: é›†æˆä¸ä¼˜åŒ–** (1 å¤©)
- [ ] 6.1 æ›´æ–° `main.ts` (é›†æˆæ‰€æœ‰è·¯ç”±)
- [ ] 6.2 æ•°æ®åº“è¿ç§»
  - [ ] 6.2.1 `prisma migrate dev`
  - [ ] 6.2.2 `prisma generate`
- [ ] 6.3 æ—¥å¿—åŸ‹ç‚¹ä¼˜åŒ–
- [ ] 6.4 é”™è¯¯å¤„ç†ä¼˜åŒ–
- [ ] 6.5 ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] 6.6 API æ–‡æ¡£ç”Ÿæˆ (å¯é€‰)

---

## ğŸ“‚ æœ€ç»ˆç›®å½•ç»“æ„

```
apps/server/src/
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ routes.ts          # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ service.ts         # è®¤è¯ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ dto.ts             # DTO ç±»å‹ (å¯é€‰)
â”‚   â”‚
â”‚   â”œâ”€â”€ oauth/
â”‚   â”‚   â”œâ”€â”€ routes.ts          # OAuth è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ github.ts          # GitHub OAuth å®ç°
â”‚   â”‚   â”œâ”€â”€ google.ts          # Google OAuth å®ç°
â”‚   â”‚   â””â”€â”€ service.ts         # OAuth å…¬å…±é€»è¾‘
â”‚   â”‚
â”‚   â””â”€â”€ user/
â”‚       â”œâ”€â”€ routes.ts          # ç”¨æˆ·è·¯ç”±
â”‚       â””â”€â”€ service.ts         # ç”¨æˆ·ä¸šåŠ¡é€»è¾‘
â”‚
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.ts                # JWT éªŒè¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ rate-limit.ts          # é™æµä¸­é—´ä»¶
â”‚   â””â”€â”€ error-handler.ts       # ç»Ÿä¸€é”™è¯¯å¤„ç†
â”‚
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ db.ts                  # Prisma Client
â”‚   â”œâ”€â”€ redis.ts               # Redis Client
â”‚   â”œâ”€â”€ email.ts               # Resend å°è£…
â”‚   â”œâ”€â”€ logger.ts              # Pino æ—¥å¿—
â”‚   â”‚
â”‚   â”œâ”€â”€ i18n/                  # å›½é™…åŒ–
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ locales/
â”‚   â”‚       â”œâ”€â”€ zh.json
â”‚   â”‚       â””â”€â”€ en.json
â”‚   â”‚
â”‚   â””â”€â”€ lib/                   # å·¥å…·åº“
â”‚       â”œâ”€â”€ jwt.ts             # JWT å·¥å…·
â”‚       â”œâ”€â”€ password.ts        # å¯†ç åŠ å¯†
â”‚       â””â”€â”€ random.ts          # éšæœºç ç”Ÿæˆ
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ env.ts                 # ç¯å¢ƒå˜é‡éªŒè¯
â”‚
â””â”€â”€ main.ts                    # åº”ç”¨å…¥å£
```

```
packages/shared/src/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ index.ts               # ç±»å‹å¯¼å‡º
â”‚   â”œâ”€â”€ models.ts              # æ•°æ®æ¨¡å‹ + æšä¸¾
â”‚   â”œâ”€â”€ api.ts                 # API æ¥å£ç±»å‹
â”‚   â””â”€â”€ error.ts               # é”™è¯¯ç±»å‹
â”‚
â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ index.ts               # Schema å¯¼å‡º
â”‚   â”œâ”€â”€ auth.ts                # è®¤è¯ Schema
â”‚   â””â”€â”€ user.ts                # ç”¨æˆ· Schema
â”‚
â”œâ”€â”€ constants/
â”‚   â””â”€â”€ index.ts               # å¸¸é‡å®šä¹‰
â”‚
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ index.ts               # çº¯å·¥å…·å‡½æ•°
â”‚
â””â”€â”€ index.ts                   # æ€»å¯¼å‡º
```

---

## ğŸ”§ æŠ€æœ¯å†³ç­–

| å†³ç­–ç‚¹ | é€‰æ‹© | ç†ç”± |
|-------|------|------|
| Session å­˜å‚¨ | æ•°æ®åº“ (Session è¡¨) | æ”¯æŒä¸»åŠ¨æ’¤é”€ï¼Œç¬¦åˆè®¾è®¡æ–‡æ¡£ |
| Token åˆ·æ–°ç­–ç•¥ | Token è½®æ¢ | å®‰å…¨æœ€ä½³å®è·µï¼Œé˜²æ­¢ Token æ³„éœ² |
| éªŒè¯ç æœ‰æ•ˆæœŸ | 10 åˆ†é’Ÿ | å¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ |
| Access Token æœ‰æ•ˆæœŸ | 15 åˆ†é’Ÿ | çŸ­æœŸæœ‰æ•ˆï¼Œé™ä½é£é™© |
| Refresh Token æœ‰æ•ˆæœŸ | 7 å¤© | ç”¨æˆ·æ— éœ€é¢‘ç¹ç™»å½• |
| å¯†ç åŠ å¯† | bcrypt (10 rounds) | ä¸šç•Œæ ‡å‡†ï¼Œå®‰å…¨å¯é  |
| éªŒè¯åº“ | Zod | å‰åç«¯å…±äº« Schema |

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æ€§
- [ ] æ‰€æœ‰ 9 ä¸ª API ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- [ ] å‰åç«¯ç±»å‹å®Œå…¨ä¸€è‡´ (æ—  TypeScript é”™è¯¯)
- [ ] æ‰€æœ‰æµç¨‹ç¬¦åˆè®¾è®¡æ–‡æ¡£ (æ³¨å†Œ/ç™»å½•/OAuth/åˆ·æ–°)

### å®‰å…¨æ€§
- [ ] å¯†ç  bcrypt åŠ å¯†å­˜å‚¨
- [ ] JWT Secret ä»ç¯å¢ƒå˜é‡è¯»å–
- [ ] Token æ”¯æŒä¸»åŠ¨æ’¤é”€
- [ ] éªŒè¯ç é˜²åˆ·æœºåˆ¶ç”Ÿæ•ˆ
- [ ] OAuth state å‚æ•°é˜² CSRF

### å¯ç»´æŠ¤æ€§
- [ ] ä»£ç ç»“æ„æ¸…æ™°ï¼ŒæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡
- [ ] å…³é”®ä½ç½®æœ‰æ—¥å¿—åŸ‹ç‚¹
- [ ] é”™è¯¯ä¿¡æ¯ç»Ÿä¸€æ ¼å¼
- [ ] æ—  TypeScript ç±»å‹é”™è¯¯

---

## ğŸš€ å¼€å§‹æ‰§è¡Œ

**æ‰§è¡Œé¡ºåº**: ä¸¥æ ¼æŒ‰ç…§é˜¶æ®µ 0 â†’ 1 â†’ 2 â†’ 3 â†’ 4 â†’ 5 â†’ 6 é¡ºåºæ‰§è¡Œ

**æ¯ä¸ªé˜¶æ®µå®Œæˆå**:
1. âœ… è¿è¡Œ `bun run type-check` éªŒè¯ç±»å‹
2. âœ… æµ‹è¯•ç›¸å…³åŠŸèƒ½
3. âœ… Git commit ä¿å­˜è¿›åº¦

---

## ğŸ“ è¿›åº¦è¿½è¸ª

- [x] é˜¶æ®µ 0: ä»£ç æ¸…ç† (3/3) âœ…
- [x] é˜¶æ®µ 1: å…±äº«æ¨¡å— (9/9) âœ…
- [x] é˜¶æ®µ 2: åç«¯åŸºç¡€è®¾æ–½ (12/12) âœ…
- [x] é˜¶æ®µ 3: æ ¸å¿ƒè®¤è¯ (6/6) âœ…
- [ ] é˜¶æ®µ 4: OAuth (0/2) â­ï¸ (å¯é€‰)
- [x] é˜¶æ®µ 5: ç”¨æˆ·åŠŸèƒ½ (1/1) âœ…
- [x] é˜¶æ®µ 6: é›†æˆä¼˜åŒ– (6/6) âœ…
  - [x] 6.1 Docker Compose é…ç½®
  - [x] 6.2 æ•°æ®åº“è¿ç§»
  - [x] 6.3 ç¯å¢ƒå˜é‡é…ç½®
  - [x] 6.4 Prisma Client é…ç½®
  - [x] 6.5 æœåŠ¡å™¨å¯åŠ¨æµ‹è¯•
  - [x] 6.6 API æµ‹è¯•è„šæœ¬

**æ€»è¿›åº¦**: 37/39 (95%) âœ…
