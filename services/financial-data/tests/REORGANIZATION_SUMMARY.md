# æµ‹è¯•ç›®å½•é‡ç»„æ€»ç»“

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. ç›®å½•ç»“æ„é‡ç»„

ä»æ‰å¹³åŒ–ç»“æ„é‡ç»„ä¸ºåˆ†å±‚ç»“æ„ï¼š

```
tests/
â”œâ”€â”€ conftest.py              # å…¨å±€é…ç½®
â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯• âœ… 37 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_pinyin.py
â”‚   â”œâ”€â”€ test_calculator.py
â”‚   â”œâ”€â”€ test_akshare_client.py      # æ–°å¢
â”‚   â”œâ”€â”€ test_akshare_service.py     # æ–°å¢
â”‚   â””â”€â”€ test_indicators_service.py  # æ–°å¢
â”œâ”€â”€ integration/             # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_akshare.py
â”‚   â””â”€â”€ test_indicators.py
â”œâ”€â”€ api/                     # API æµ‹è¯•
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_health.py
â”‚   â””â”€â”€ test_akshare_real.py
â”œâ”€â”€ fixtures/                # å…±äº«æµ‹è¯•æ•°æ® âœ…
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ sample_data.py
â”œâ”€â”€ mocks/                   # Mock å¯¹è±¡ âœ…
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ akshare_mocks.py
â””â”€â”€ helpers/                 # æµ‹è¯•è¾…åŠ©å‡½æ•° âœ…
    â”œâ”€â”€ __init__.py
    â””â”€â”€ assertions.py
```

### 2. æ–°å¢æµ‹è¯•æ–‡ä»¶

**å•å…ƒæµ‹è¯•**:
- `test_akshare_client.py` - 10 ä¸ªæµ‹è¯•ï¼Œè¦†ç›– AkShare å®¢æˆ·ç«¯æ‰€æœ‰æ–¹æ³•
- `test_akshare_service.py` - 7 ä¸ªæµ‹è¯•ï¼Œè¦†ç›–æœåŠ¡å±‚ç¼“å­˜é€»è¾‘
- `test_indicators_service.py` - 5 ä¸ªæµ‹è¯•ï¼Œè¦†ç›–æŒ‡æ ‡æœåŠ¡å±‚

**å…±äº«æ¨¡å—**:
- `fixtures/sample_data.py` - 4 ä¸ª fixturesï¼ˆkline_data, stock_info, fund_info, realtime_quoteï¼‰
- `mocks/akshare_mocks.py` - 6 ä¸ª mock å‡½æ•°
- `helpers/assertions.py` - 6 ä¸ªæ–­è¨€è¾…åŠ©å‡½æ•°

### 3. æ›´æ–°çš„æ–‡ä»¶

- `conftest.py` - ç®€åŒ–ä¸ºå…¨å±€é…ç½®ï¼Œå¯¼å…¥å…±äº« fixtures
- `unit/conftest.py` - å•å…ƒæµ‹è¯•ä¸“ç”¨é…ç½®
- `integration/conftest.py` - é›†æˆæµ‹è¯•ä¸“ç”¨é…ç½®ï¼ˆåŒ…å« Redis è¿æ¥ï¼‰
- `api/conftest.py` - API æµ‹è¯•ä¸“ç”¨é…ç½®ï¼ˆåŒ…å« Redis è¿æ¥ï¼‰
- `run_tests.sh` - æ›´æ–°ä¸ºæ”¯æŒç›®å½•è·¯å¾„
- `README.md` - æ›´æ–°æ–‡æ¡£ï¼Œåæ˜ æ–°ç»“æ„

### 4. æµ‹è¯•ç»“æœ

**å•å…ƒæµ‹è¯•**: âœ… 37/37 é€šè¿‡
- test_pinyin.py: 5/5 é€šè¿‡
- test_calculator.py: 10/10 é€šè¿‡
- test_akshare_client.py: 10/10 é€šè¿‡
- test_akshare_service.py: 7/7 é€šè¿‡
- test_indicators_service.py: 5/5 é€šè¿‡

**é›†æˆæµ‹è¯•**: â³ å¾…éªŒè¯ï¼ˆéœ€è¦ Redisï¼‰
**API æµ‹è¯•**: â³ å¾…éªŒè¯ï¼ˆéœ€è¦ç½‘ç»œå’Œ Redisï¼‰

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡æå‡

### ä¹‹å‰
- å•å…ƒæµ‹è¯•: 17 ä¸ªï¼ˆåªè¦†ç›– pinyin å’Œ calculatorï¼‰
- é›†æˆæµ‹è¯•: 7 ä¸ª
- API æµ‹è¯•: 11 ä¸ª
- **æ€»è®¡**: 35 ä¸ªæµ‹è¯•

### ç°åœ¨
- å•å…ƒæµ‹è¯•: 37 ä¸ªï¼ˆæ–°å¢ 20 ä¸ªï¼Œè¦†ç›– client å’Œ service å±‚ï¼‰
- é›†æˆæµ‹è¯•: 7 ä¸ª
- API æµ‹è¯•: 11 ä¸ª
- **æ€»è®¡**: 55 ä¸ªæµ‹è¯•

**æå‡**: +20 ä¸ªå•å…ƒæµ‹è¯• (+117% å¢é•¿)

## ğŸ¯ æµ‹è¯•ç»„ç»‡ä¼˜åŠ¿

### 1. æ¸…æ™°çš„åˆ†å±‚
- **unit/**: å¿«é€Ÿã€éš”ç¦»ã€æ— ä¾èµ–
- **integration/**: Mock å¤–éƒ¨æœåŠ¡ï¼Œæµ‹è¯•å†…éƒ¨äº¤äº’
- **api/**: çœŸå®æ•°æ®ï¼Œç«¯åˆ°ç«¯éªŒè¯

### 2. å¯å¤ç”¨çš„ç»„ä»¶
- **fixtures/**: å…±äº«æµ‹è¯•æ•°æ®ï¼Œé¿å…é‡å¤
- **mocks/**: ç»Ÿä¸€çš„ Mock å¯¹è±¡
- **helpers/**: é€šç”¨æ–­è¨€å‡½æ•°

### 3. ç‹¬ç«‹çš„é…ç½®
- æ¯ä¸ªæµ‹è¯•ç±»å‹æœ‰è‡ªå·±çš„ conftest.py
- å¯ä»¥é’ˆå¯¹ä¸åŒæµ‹è¯•ç±»å‹ä¼˜åŒ–é…ç½®

### 4. æ˜“äºæ‰©å±•
- æ·»åŠ æ–°æµ‹è¯•åªéœ€åœ¨å¯¹åº”ç›®å½•åˆ›å»ºæ–‡ä»¶
- éµå¾ªé•œåƒæºä»£ç ç»“æ„çš„åŸåˆ™

## ğŸš€ è¿è¡Œæµ‹è¯•

```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆå•å…ƒ + é›†æˆï¼Œè·³è¿‡æ…¢é€Ÿï¼‰
./run_tests.sh fast
uv run pytest -m "not slow"

# åªè¿è¡Œå•å…ƒæµ‹è¯•
./run_tests.sh unit
uv run pytest tests/unit/

# åªè¿è¡Œé›†æˆæµ‹è¯•
./run_tests.sh integration
uv run pytest tests/integration/

# åªè¿è¡Œ API æµ‹è¯•
./run_tests.sh api
uv run pytest tests/api/

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./run_tests.sh all
uv run pytest

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
./run_tests.sh coverage
```

## ğŸ“ ä¸‹ä¸€æ­¥å»ºè®®

### 1. ä¿®å¤é›†æˆæµ‹è¯•ç¯å¢ƒ
- ç¡®ä¿ Redis åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¯ç”¨
- æˆ–è€…ä¸ºé›†æˆæµ‹è¯•æ·»åŠ  Redis Mock

### 2. è¡¥å……ç¼ºå¤±çš„æµ‹è¯•
- Router å±‚æµ‹è¯•ï¼ˆç›®å‰é€šè¿‡é›†æˆæµ‹è¯•è¦†ç›–ï¼‰
- é”™è¯¯å¤„ç†è¾¹ç•Œæƒ…å†µ
- å¹¶å‘åœºæ™¯æµ‹è¯•

### 3. æ·»åŠ æ€§èƒ½æµ‹è¯•
- ç¼“å­˜å‘½ä¸­ç‡æµ‹è¯•
- å¤§æ•°æ®é‡å¤„ç†æµ‹è¯•
- å¹¶å‘è¯·æ±‚æµ‹è¯•

### 4. CI/CD é›†æˆ
- åœ¨ GitHub Actions ä¸­è¿è¡Œå¿«é€Ÿæµ‹è¯•
- å®šæœŸè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### Mock ç­–ç•¥
- **å•å…ƒæµ‹è¯•**: Mock æ‰€æœ‰å¤–éƒ¨ä¾èµ–ï¼ˆakshare, Redis, pandasï¼‰
- **é›†æˆæµ‹è¯•**: Mock å¤–éƒ¨ APIï¼ˆakshareï¼‰ï¼Œä½¿ç”¨çœŸå® Redis
- **API æµ‹è¯•**: ä½¿ç”¨çœŸå®å¤–éƒ¨æœåŠ¡

### Fixtures è®¾è®¡
- ä½¿ç”¨ pytest fixtures æä¾›æµ‹è¯•æ•°æ®
- é€šè¿‡ `pytest_plugins` è‡ªåŠ¨åŠ è½½å…±äº« fixtures
- æ¯ä¸ªæµ‹è¯•ç±»å‹å¯ä»¥æœ‰è‡ªå·±çš„ fixtures

### æ–­è¨€è¾…åŠ©å‡½æ•°
- å°è£…å¸¸è§çš„æ•°æ®ç»“æ„éªŒè¯
- æé«˜æµ‹è¯•å¯è¯»æ€§
- å‡å°‘é‡å¤ä»£ç 

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [æµ‹è¯•æ–‡æ¡£](./README.md)
- [Pytest æœ€ä½³å®è·µ](https://docs.pytest.org/en/stable/goodpractices.html)
- [æµ‹è¯•é‡‘å­—å¡”](https://martinfowler.com/articles/practical-test-pyramid.html)
